@startuml
participant "Main" as Main
participant "Storage" as Storage
participant "User" as User
participant "ModuleList" as ModuleList
participant "BufferedWriter" as BW
database "File" as File

Main -> Storage : saveModulesToFile(filePath)
activate Storage

Storage -> Storage : ensureDirectoryExists(filePath)
activate Storage
opt if directory does not exist
Storage -> File : create directory
end
Storage --> Storage : directory OK
deactivate Storage

Storage -> BW : new BufferedWriter(new FileWriter(filePath))
activate BW

opt User Data
    Storage -> User : toString()
    activate User
    User --> Storage : user data as string
    deactivate User
    Storage -> BW : write(user data + System.lineSeparator())
    BW -> File : write user data
end

Storage -> ModuleList : getTakenModuleList()
activate ModuleList
ModuleList --> Storage : list of Modules
deactivate ModuleList

loop for each Module
    Storage -> BW : write(toString(module) + System.lineSeparator())
    BW -> File : write module data
end

deactivate BW
Storage --> Main : Data saved
deactivate Storage

@enduml
